<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuanki æ–°ç‰ˆå¡ç‰‡è§£æè®¾ç½® - åŸå‹è®¾è®¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1e1e1e;
            color: #dcddde;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            margin-bottom: 30px;
        }

        .tabs-nav {
            display: flex;
            gap: 2px;
            margin-bottom: 30px;
            background: #40444b;
            border-radius: 8px;
            padding: 4px;
        }

        .tab-button {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: #b9bbbe;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .tab-button:hover {
            background: #36393f;
            color: #dcddde;
        }

        .tab-button.active {
            background: #7289da;
            color: white;
        }

        .hidden {
            display: none !important;
        }

        .panel-description {
            color: #b9bbbe;
            font-size: 14px;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .settings-panel {
            background: #2f3136;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #40444b;
        }

        .preview-panel {
            background: #2f3136;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #40444b;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "âš™ï¸";
            font-size: 1.2em;
        }

        .preview-panel .section-title::before {
            content: "ğŸ‘ï¸";
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #b9bbbe;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 12px;
            background: #40444b;
            border: 1px solid #72767d;
            border-radius: 6px;
            color: #dcddde;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #7289da;
            box-shadow: 0 0 0 2px rgba(114, 137, 218, 0.2);
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #72767d;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .switch.active {
            background: #7289da;
        }

        .switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .switch.active::after {
            transform: translateX(26px);
        }

        .symbol-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .help-text {
            display: block;
            font-size: 12px;
            color: #72767d;
            margin-top: 4px;
            line-height: 1.3;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .template-list {
            display: grid;
            gap: 15px;
        }

        .template-item {
            background: #36393f;
            border: 1px solid #40444b;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }

        .template-item:hover {
            border-color: #7289da;
            box-shadow: 0 2px 8px rgba(114, 137, 218, 0.1);
        }

        .template-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .template-info h4 {
            color: #ffffff;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .template-info p {
            color: #b9bbbe;
            font-size: 13px;
            margin: 0;
        }

        .template-type {
            background: #5865f2;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .template-type.single-field {
            background: #43b581;
        }

        .template-type.complete-regex {
            background: #faa61a;
        }

        .template-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .template-actions .btn {
            padding: 6px 12px;
            font-size: 12px;
        }

        .template-fields {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #40444b;
        }

        .field-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 13px;
        }

        .field-name {
            color: #7289da;
            font-weight: 500;
        }

        .field-regex {
            color: #b9bbbe;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 11px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .test-area {
            margin-top: 20px;
        }

        .test-input {
            width: 100%;
            height: 200px;
            padding: 15px;
            background: #40444b;
            border: 1px solid #72767d;
            border-radius: 6px;
            color: #dcddde;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            resize: vertical;
            line-height: 1.5;
        }

        .test-input:focus {
            outline: none;
            border-color: #7289da;
            box-shadow: 0 0 0 2px rgba(114, 137, 218, 0.2);
        }

        .preview-cards {
            margin-top: 20px;
        }

        .card-preview {
            background: #36393f;
            border: 1px solid #40444b;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .card-header {
            background: #7289da;
            color: white;
            padding: 10px 15px;
            font-weight: 500;
            font-size: 14px;
        }

        .card-content {
            padding: 15px;
        }

        .card-side {
            margin-bottom: 12px;
        }

        .card-side-label {
            font-size: 12px;
            color: #b9bbbe;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .card-side-content {
            background: #2f3136;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #7289da;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .card-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .tag {
            background: #5865f2;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .stats-bar {
            background: #36393f;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #7289da;
        }

        .stat-label {
            font-size: 12px;
            color: #b9bbbe;
            margin-top: 2px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #7289da;
            color: white;
        }

        .btn-primary:hover {
            background: #677bc4;
        }

        .btn-secondary {
            background: #40444b;
            color: #dcddde;
            border: 1px solid #72767d;
        }

        .btn-secondary:hover {
            background: #484c52;
        }

        .example-selector {
            margin-bottom: 15px;
        }

        .example-selector select {
            width: 100%;
            padding: 8px;
            background: #40444b;
            border: 1px solid #72767d;
            border-radius: 4px;
            color: #dcddde;
            font-size: 13px;
        }

        .cloze-highlight {
            background: #ffd700;
            color: #000;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
        }

        .mcq-option {
            margin: 5px 0;
            padding: 5px 10px;
            background: #40444b;
            border-radius: 4px;
            border-left: 3px solid #72767d;
        }

        .mcq-option.correct {
            border-left-color: #43b581;
            background: rgba(67, 181, 129, 0.1);
        }

        /* æ¨¡æ€çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: #2f3136;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            border: 1px solid #40444b;
        }

        .modal-header {
            background: #36393f;
            padding: 20px;
            border-bottom: 1px solid #40444b;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #ffffff;
            margin: 0;
            font-size: 18px;
        }

        .modal-close {
            background: none;
            border: none;
            color: #b9bbbe;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #40444b;
            color: #dcddde;
        }

        .modal-body {
            padding: 25px;
            max-height: calc(90vh - 140px);
            overflow-y: auto;
        }

        .modal-footer {
            background: #36393f;
            padding: 15px 20px;
            border-top: 1px solid #40444b;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .template-mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-button {
            flex: 1;
            padding: 12px;
            background: #40444b;
            border: 1px solid #72767d;
            border-radius: 6px;
            color: #dcddde;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .mode-button.active {
            background: #7289da;
            border-color: #7289da;
            color: white;
        }

        .field-editor {
            background: #40444b;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .field-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .field-editor-header h5 {
            color: #ffffff;
            margin: 0;
            font-size: 14px;
        }

        .remove-field {
            background: #ed4245;
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .regex-input {
            width: 100%;
            padding: 8px;
            background: #36393f;
            border: 1px solid #72767d;
            border-radius: 4px;
            color: #dcddde;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .symbol-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal {
                width: 95%;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Tuanki æ–°ç‰ˆå¡ç‰‡è§£æè®¾ç½®</h1>
            <p>ç»Ÿä¸€æ¨¡æ¿ç®¡ç† + å…¨å±€åˆ†éš”ç¬¦é…ç½® - å®Œå…¨æ›¿ä»£ä¸‰ä½ä¸€ä½“æ¨¡æ¿ç³»ç»Ÿ</p>
        </div>

        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tabs-nav">
            <button class="tab-button active" data-tab="symbols">åˆ†éš”ç¬¦é…ç½®</button>
            <button class="tab-button" data-tab="templates">æ¨¡æ¿ç®¡ç†</button>
            <button class="tab-button" data-tab="preview">å®æ—¶é¢„è§ˆ</button>
        </div>

        <div class="main-content">
            <!-- åˆ†éš”ç¬¦é…ç½®é¢æ¿ -->
            <div class="settings-panel" id="symbolsPanel">
                <h2 class="section-title">å…¨å±€åˆ†éš”ç¬¦é…ç½®</h2>
                <p class="panel-description">è¿™äº›åˆ†éš”ç¬¦é€‚ç”¨äºæ‰€æœ‰æ¨¡æ¿ï¼Œç¡®ä¿è§£æçš„ä¸€è‡´æ€§</p>

                <!-- æ ‡ç­¾è§¦å‘è®¾ç½® -->
                <div class="form-group">
                    <div class="toggle-switch">
                        <div class="switch active" id="tagTriggerSwitch"></div>
                        <label>å¯ç”¨æ ‡ç­¾è§¦å‘</label>
                    </div>
                    <div class="form-group">
                        <label for="triggerTag">è§¦å‘æ ‡ç­¾</label>
                        <input type="text" id="triggerTag" value="#tuanki" placeholder="ä¾‹å¦‚: #tuanki">
                        <small class="help-text">åªæœ‰åŒ…å«æ­¤æ ‡ç­¾çš„å†…å®¹æ‰ä¼šè¢«è§£æä¸ºå¡ç‰‡</small>
                    </div>
                </div>

                <!-- ç¬¦å·é…ç½® -->
                <div class="form-group">
                    <label>æ ¸å¿ƒåˆ†éš”ç¬¦</label>
                    <div class="symbol-grid">
                        <div>
                            <label for="rangeStart">æ‰¹é‡èŒƒå›´èµ·å§‹</label>
                            <input type="text" id="rangeStart" value="---start---">
                            <small class="help-text">æ‰¹é‡è§£æçš„å¼€å§‹æ ‡è®°</small>
                        </div>
                        <div>
                            <label for="rangeEnd">æ‰¹é‡èŒƒå›´ç»“æŸ</label>
                            <input type="text" id="rangeEnd" value="---end---">
                            <small class="help-text">æ‰¹é‡è§£æçš„ç»“æŸæ ‡è®°</small>
                        </div>
                        <div>
                            <label for="cardDelimiter">å¡ç‰‡åˆ†éš”ç¬¦</label>
                            <input type="text" id="cardDelimiter" value="---å¡ç‰‡---">
                            <small class="help-text">æ‰¹é‡èŒƒå›´å†…åˆ†éš”å¤šå¼ å¡ç‰‡</small>
                        </div>
                        <div>
                            <label for="faceDelimiter">æ­£åé¢åˆ†éš”</label>
                            <input type="text" id="faceDelimiter" value="---div---">
                            <small class="help-text">åˆ†éš”å¡ç‰‡æ­£é¢å’ŒèƒŒé¢å†…å®¹</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clozeMarker">æŒ–ç©ºæ ‡è®°</label>
                        <input type="text" id="clozeMarker" value="==é«˜äº®æ–‡æœ¬==">
                        <small class="help-text">æŒ–ç©ºé¢˜çš„æ ‡è®°æ ¼å¼</small>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ¿ç®¡ç†é¢æ¿ -->
            <div class="settings-panel hidden" id="templatesPanel">
                <div class="template-header">
                    <h2 class="section-title">æ¨¡æ¿ç®¡ç†</h2>
                    <button class="btn btn-primary" id="addTemplateBtn">+ æ–°å»ºæ¨¡æ¿</button>
                </div>
                <p class="panel-description">ç®¡ç†æ‰€æœ‰åœºæ™¯ä½¿ç”¨çš„è§£ææ¨¡æ¿ï¼Œæ”¯æŒå•å­—æ®µè§£æå’Œå®Œæ•´æ­£åˆ™è§£æ</p>

                <!-- æ¨¡æ¿åˆ—è¡¨ -->
                <div class="template-list" id="templateList">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„æ¨¡æ¿é¡¹ -->
                </div>
            </div>

            <!-- å®æ—¶é¢„è§ˆé¢æ¿ -->
            <div class="settings-panel hidden" id="previewPanel">
                <h2 class="section-title">å®æ—¶é¢„è§ˆ</h2>
                <p class="panel-description">æµ‹è¯•åˆ†éš”ç¬¦å’Œæ¨¡æ¿çš„è§£ææ•ˆæœ</p>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="cardCount">2</div>
                        <div class="stat-label">å¡ç‰‡æ•°é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="clozeCount">3</div>
                        <div class="stat-label">æŒ–ç©ºæ•°é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tagCount">4</div>
                        <div class="stat-label">æ ‡ç­¾æ•°é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="templateCount">2</div>
                        <div class="stat-label">ä½¿ç”¨æ¨¡æ¿</div>
                    </div>
                </div>

                <!-- ç¤ºä¾‹é€‰æ‹©å™¨ -->
                <div class="example-selector">
                    <select id="exampleSelector">
                        <option value="">é€‰æ‹©ç¤ºä¾‹...</option>
                        <option value="qa">é—®ç­”é¢˜ç¤ºä¾‹</option>
                        <option value="mcq">é€‰æ‹©é¢˜ç¤ºä¾‹</option>
                        <option value="cloze">æŒ–ç©ºé¢˜ç¤ºä¾‹</option>
                        <option value="batch">æ‰¹é‡å¡ç‰‡ç¤ºä¾‹</option>
                        <option value="template">æ¨¡æ¿è§£æç¤ºä¾‹</option>
                    </select>
                </div>

                <!-- æµ‹è¯•è¾“å…¥ -->
                <div class="test-area">
                    <label for="testInput">æµ‹è¯•å†…å®¹</label>
                    <textarea id="testInput" class="test-input" placeholder="åœ¨æ­¤è¾“å…¥æµ‹è¯•å†…å®¹...">## ä»€ä¹ˆæ˜¯é—´éš”é‡å¤ï¼Ÿ
é—´éš”é‡å¤æ˜¯ä¸€ç§åŸºäº==é—å¿˜æ›²çº¿==çš„å­¦ä¹ æ–¹æ³•ã€‚
---div---
é—´éš”é‡å¤é€šè¿‡åœ¨==æœ€ä½³æ—¶æœº==å¤ä¹ æ¥æé«˜è®°å¿†æ•ˆç‡ã€‚å®ƒç”±==è‰¾å®¾æµ©æ–¯==é¦–æ¬¡æå‡ºã€‚
#å­¦ä¹ æ–¹æ³• #è®°å¿† #tuanki</textarea>
                </div>

                <!-- è§£æç»“æœ -->
                <div class="preview-cards" id="previewCards">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„å¡ç‰‡é¢„è§ˆ -->
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-buttons">
            <button class="btn btn-secondary">é‡ç½®ä¸ºé»˜è®¤</button>
            <button class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
            <button class="btn btn-secondary">å¯¼å‡ºé…ç½®</button>
        </div>
    </div>

    <!-- æ¨¡æ¿ç¼–è¾‘æ¨¡æ€çª— -->
    <div class="modal-overlay hidden" id="templateModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">æ–°å»ºæ¨¡æ¿</h3>
                <button class="modal-close" id="closeModal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="templateForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="templateName">æ¨¡æ¿åç§°</label>
                            <input type="text" id="templateName" placeholder="ä¾‹å¦‚ï¼šåŸºç¡€é—®ç­”å¡">
                        </div>
                        <div class="form-group">
                            <label for="templateDescription">æ¨¡æ¿æè¿°</label>
                            <input type="text" id="templateDescription" placeholder="æ¨¡æ¿ç”¨é€”è¯´æ˜">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>è§£ææ¨¡å¼</label>
                        <div class="template-mode-selector">
                            <div class="mode-button active" data-mode="single-field">
                                <strong>å•å­—æ®µè§£æ</strong><br>
                                <small>é€‚ç”¨äºå•å¡è§£æã€æ–°å»ºå¡ç‰‡</small>
                            </div>
                            <div class="mode-button" data-mode="complete-regex">
                                <strong>å®Œæ•´æ­£åˆ™è§£æ</strong><br>
                                <small>é€‚ç”¨äºæ‰¹é‡å¡ç‰‡æ‰«æ</small>
                            </div>
                        </div>
                    </div>

                    <!-- å•å­—æ®µè§£æé…ç½® -->
                    <div id="singleFieldConfig">
                        <div class="form-group">
                            <label>å­—æ®µé…ç½®</label>
                            <div id="fieldsList">
                                <!-- åŠ¨æ€ç”Ÿæˆçš„å­—æ®µç¼–è¾‘å™¨ -->
                            </div>
                            <button type="button" class="btn btn-secondary" id="addFieldBtn">+ æ·»åŠ å­—æ®µ</button>
                        </div>
                    </div>

                    <!-- å®Œæ•´æ­£åˆ™è§£æé…ç½® -->
                    <div id="completeRegexConfig" class="hidden">
                        <div class="form-group">
                            <label for="completeRegex">å®Œæ•´æ­£åˆ™è¡¨è¾¾å¼</label>
                            <textarea id="completeRegex" class="regex-input" rows="4"
                                placeholder="ä¾‹å¦‚ï¼š^(?<front>.+?)(?:---div---(?<back>.+?))?(?<tags>#[\\w\\u4e00-\\u9fa5]+.*)?$"></textarea>
                            <small class="help-text">ä½¿ç”¨å‘½åæ•è·ç»„ï¼š(?&lt;front&gt;...)ã€(?&lt;back&gt;...)ã€(?&lt;tags&gt;...)</small>
                        </div>
                        <div class="form-group">
                            <label for="regexFlags">æ­£åˆ™æ ‡å¿—</label>
                            <input type="text" id="regexFlags" value="ms" placeholder="ä¾‹å¦‚ï¼šgims">
                            <small class="help-text">å¸¸ç”¨æ ‡å¿—ï¼šg(å…¨å±€)ã€i(å¿½ç•¥å¤§å°å†™)ã€m(å¤šè¡Œ)ã€s(å•è¡Œ)</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>åº”ç”¨åœºæ™¯</label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="useInNewCard" checked>
                                <span>æ–°å»ºå¡ç‰‡</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="useInStudy" checked>
                                <span>å­¦ä¹ æ¨¡æ€çª—</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="checkbox" id="useInBatch">
                                <span>æ‰¹é‡æ‰«æ</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTemplate">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveTemplate">ä¿å­˜æ¨¡æ¿</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentTab = 'symbols';
        let templates = [
            {
                id: 'default-qa',
                name: 'åŸºç¡€é—®ç­”å¡',
                description: 'æ ‡å‡†çš„é—®ç­”é¢˜æ¨¡æ¿',
                type: 'single-field',
                fields: [
                    { name: 'Front', regex: '^(.+?)(?=---div---|$)', flags: 'ms' },
                    { name: 'Back', regex: '(?<=---div---)(.+)$', flags: 'ms' },
                    { name: 'Tags', regex: '#([\\w\\u4e00-\\u9fa5]+)', flags: 'g' }
                ],
                scenarios: ['newCard', 'study'],
                isDefault: true
            },
            {
                id: 'batch-complete',
                name: 'æ‰¹é‡å®Œæ•´è§£æ',
                description: 'ç”¨äºæ‰¹é‡å¡ç‰‡æ‰«æçš„å®Œæ•´æ­£åˆ™',
                type: 'complete-regex',
                regex: '^(?<front>.+?)(?:---div---(?<back>.+?))?(?<tags>#[\\w\\u4e00-\\u9fa5]+.*)?$',
                flags: 'ms',
                scenarios: ['batch'],
                isDefault: true
            }
        ];

        // ç¤ºä¾‹æ•°æ®
        const examples = {
            qa: `## ä»€ä¹ˆæ˜¯FSRSç®—æ³•ï¼Ÿ
FSRSæ˜¯ä¸€ç§ç°ä»£åŒ–çš„é—´éš”é‡å¤ç®—æ³•ã€‚
---div---
FSRS (Free Spaced Repetition Scheduler) æ˜¯åŸºäºè®°å¿†æ¨¡å‹çš„æ™ºèƒ½è°ƒåº¦ç®—æ³•ï¼Œæ¯”ä¼ ç»ŸSMç®—æ³•æ›´å‡†ç¡®ã€‚
#ç®—æ³• #FSRS #tuanki`,

            mcq: `## Javaä¸­å“ªä¸ªä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ #ç¼–ç¨‹ #tuanki
- [ ] int
- [ ] boolean
- [x] String
- [ ] double
---div---
Stringæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€‚Javaçš„8ç§åŸºæœ¬ç±»å‹æ˜¯ï¼šbyte, short, int, long, float, double, boolean, charã€‚`,

            cloze: `==è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿==è¡¨æ˜äººä»¬åœ¨å­¦ä¹ åä¼šå¿«é€Ÿé—å¿˜ã€‚
ç ”ç©¶å‘ç°ï¼Œåœ¨å­¦ä¹ åçš„==20åˆ†é’Ÿ==å†…ä¼šé—å¿˜42%çš„å†…å®¹ã€‚
å› æ­¤éœ€è¦åœ¨==å…³é”®æ—¶é—´ç‚¹==è¿›è¡Œå¤ä¹ ã€‚
#è®°å¿†ç§‘å­¦ #é—å¿˜æ›²çº¿ #tuanki`,

            batch: `---start---

## é—®é¢˜1ï¼šä»€ä¹ˆæ˜¯Obsidianï¼Ÿ
---div---
Obsidianæ˜¯ä¸€æ¬¾åŸºäºMarkdownçš„çŸ¥è¯†ç®¡ç†å·¥å…·ã€‚
#å·¥å…· #tuanki

---å¡ç‰‡---

## é€‰æ‹©é¢˜ï¼šå“ªä¸ªæ˜¯Markdownè¯­æ³•ï¼Ÿ #è¯­æ³• #tuanki
- [x] **ç²—ä½“**
- [ ] <b>ç²—ä½“</b>
- [ ] [ç²—ä½“]
---div---
Markdownä½¿ç”¨**æ–‡æœ¬**æˆ–__æ–‡æœ¬__è¡¨ç¤ºç²—ä½“ã€‚

---å¡ç‰‡---

é—´éš”é‡å¤çš„æ ¸å¿ƒæ˜¯åœ¨==é—å¿˜ä¸´ç•Œç‚¹==è¿›è¡Œå¤ä¹ ã€‚
è¿™æ ·å¯ä»¥æœ€å¤§åŒ–==å­¦ä¹ æ•ˆç‡==ã€‚
#å­¦ä¹ æ–¹æ³• #tuanki

---end---`,

            template: `Front: ä»€ä¹ˆæ˜¯é—´éš”é‡å¤ï¼Ÿ
Back: é—´éš”é‡å¤æ˜¯ä¸€ç§å­¦ä¹ æŠ€æœ¯
Tags: #å­¦ä¹  #tuanki

Front: FSRSç®—æ³•çš„ä¼˜åŠ¿ï¼Ÿ
Back: æ›´å‡†ç¡®çš„è®°å¿†é¢„æµ‹
Tags: #ç®—æ³• #tuanki`
        };

        // DOM å…ƒç´ 
        const tagTriggerSwitch = document.getElementById('tagTriggerSwitch');
        const exampleSelector = document.getElementById('exampleSelector');
        const testInput = document.getElementById('testInput');
        const previewCards = document.getElementById('previewCards');
        const templateModal = document.getElementById('templateModal');
        const templateList = document.getElementById('templateList');

        // æ ‡ç­¾é¡µåˆ‡æ¢
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tab = button.dataset.tab;
                switchTab(tab);
            });
        });

        function switchTab(tab) {
            // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });

            // æ˜¾ç¤ºå¯¹åº”é¢æ¿
            document.getElementById('symbolsPanel').classList.toggle('hidden', tab !== 'symbols');
            document.getElementById('templatesPanel').classList.toggle('hidden', tab !== 'templates');
            document.getElementById('previewPanel').classList.toggle('hidden', tab !== 'preview');

            currentTab = tab;

            // å¦‚æœåˆ‡æ¢åˆ°æ¨¡æ¿ç®¡ç†ï¼Œæ¸²æŸ“æ¨¡æ¿åˆ—è¡¨
            if (tab === 'templates') {
                renderTemplateList();
            }
        }

        // å¼€å…³åˆ‡æ¢
        function toggleSwitch(switchElement) {
            switchElement.classList.toggle('active');
        }

        tagTriggerSwitch.addEventListener('click', () => toggleSwitch(tagTriggerSwitch));

        // æ¨¡æ¿ç®¡ç†
        function renderTemplateList() {
            templateList.innerHTML = '';

            templates.forEach(template => {
                const templateItem = document.createElement('div');
                templateItem.className = 'template-item';

                const typeClass = template.type === 'single-field' ? 'single-field' : 'complete-regex';
                const typeLabel = template.type === 'single-field' ? 'å•å­—æ®µè§£æ' : 'å®Œæ•´æ­£åˆ™è§£æ';

                let fieldsHtml = '';
                if (template.type === 'single-field' && template.fields) {
                    fieldsHtml = `
                        <div class="template-fields">
                            ${template.fields.map(field => `
                                <div class="field-item">
                                    <span class="field-name">${field.name}</span>
                                    <span class="field-regex">${field.regex}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else if (template.type === 'complete-regex') {
                    fieldsHtml = `
                        <div class="template-fields">
                            <div class="field-item">
                                <span class="field-name">æ­£åˆ™è¡¨è¾¾å¼</span>
                                <span class="field-regex">${template.regex}</span>
                            </div>
                        </div>
                    `;
                }

                templateItem.innerHTML = `
                    <div class="template-item-header">
                        <div class="template-info">
                            <h4>${template.name}</h4>
                            <p>${template.description}</p>
                        </div>
                        <span class="template-type ${typeClass}">${typeLabel}</span>
                    </div>
                    ${fieldsHtml}
                    <div class="template-actions">
                        <button class="btn btn-secondary" onclick="editTemplate('${template.id}')">ç¼–è¾‘</button>
                        <button class="btn btn-secondary" onclick="duplicateTemplate('${template.id}')">å¤åˆ¶</button>
                        ${!template.isDefault ? `<button class="btn btn-secondary" onclick="deleteTemplate('${template.id}')" style="background: #ed4245;">åˆ é™¤</button>` : ''}
                    </div>
                `;

                templateList.appendChild(templateItem);
            });
        }

        // æ¨¡æ¿æ¨¡æ€çª—ç®¡ç†
        let currentEditingTemplate = null;

        document.getElementById('addTemplateBtn').addEventListener('click', () => {
            openTemplateModal();
        });

        document.getElementById('closeModal').addEventListener('click', closeTemplateModal);
        document.getElementById('cancelTemplate').addEventListener('click', closeTemplateModal);

        function openTemplateModal(templateId = null) {
            currentEditingTemplate = templateId;
            const modal = document.getElementById('templateModal');
            const title = document.getElementById('modalTitle');

            if (templateId) {
                const template = templates.find(t => t.id === templateId);
                title.textContent = 'ç¼–è¾‘æ¨¡æ¿';
                populateTemplateForm(template);
            } else {
                title.textContent = 'æ–°å»ºæ¨¡æ¿';
                resetTemplateForm();
            }

            modal.classList.remove('hidden');
        }

        function closeTemplateModal() {
            document.getElementById('templateModal').classList.add('hidden');
            currentEditingTemplate = null;
        }

        function populateTemplateForm(template) {
            document.getElementById('templateName').value = template.name;
            document.getElementById('templateDescription').value = template.description;

            // è®¾ç½®æ¨¡å¼
            const modeButtons = document.querySelectorAll('.template-mode-selector .mode-button');
            modeButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === template.type);
            });

            switchTemplateMode(template.type);

            if (template.type === 'single-field') {
                // å¡«å……å­—æ®µé…ç½®
                renderFieldEditors(template.fields);
            } else {
                // å¡«å……å®Œæ•´æ­£åˆ™
                document.getElementById('completeRegex').value = template.regex;
                document.getElementById('regexFlags').value = template.flags;
            }
        }

        function resetTemplateForm() {
            document.getElementById('templateName').value = '';
            document.getElementById('templateDescription').value = '';
            document.getElementById('completeRegex').value = '';
            document.getElementById('regexFlags').value = 'ms';

            // é‡ç½®ä¸ºå•å­—æ®µæ¨¡å¼
            const modeButtons = document.querySelectorAll('.template-mode-selector .mode-button');
            modeButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === 'single-field');
            });

            switchTemplateMode('single-field');
            renderFieldEditors([
                { name: 'Front', regex: '^(.+?)(?=---div---|$)', flags: 'ms' },
                { name: 'Back', regex: '(?<=---div---)(.+)$', flags: 'ms' }
            ]);
        }

        // æ¨¡æ¿æ¨¡å¼åˆ‡æ¢
        document.querySelectorAll('.template-mode-selector .mode-button').forEach(button => {
            button.addEventListener('click', () => {
                const mode = button.dataset.mode;
                document.querySelectorAll('.template-mode-selector .mode-button').forEach(b => {
                    b.classList.remove('active');
                });
                button.classList.add('active');
                switchTemplateMode(mode);
            });
        });

        function switchTemplateMode(mode) {
            const singleFieldConfig = document.getElementById('singleFieldConfig');
            const completeRegexConfig = document.getElementById('completeRegexConfig');

            if (mode === 'single-field') {
                singleFieldConfig.classList.remove('hidden');
                completeRegexConfig.classList.add('hidden');
            } else {
                singleFieldConfig.classList.add('hidden');
                completeRegexConfig.classList.remove('hidden');
            }
        }

        // å­—æ®µç¼–è¾‘å™¨ç®¡ç†
        function renderFieldEditors(fields) {
            const fieldsList = document.getElementById('fieldsList');
            fieldsList.innerHTML = '';

            fields.forEach((field, index) => {
                const fieldEditor = createFieldEditor(field, index);
                fieldsList.appendChild(fieldEditor);
            });
        }

        function createFieldEditor(field, index) {
            const div = document.createElement('div');
            div.className = 'field-editor';
            div.innerHTML = `
                <div class="field-editor-header">
                    <h5>å­—æ®µ ${index + 1}</h5>
                    <button type="button" class="remove-field" onclick="removeField(this)">åˆ é™¤</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å­—æ®µåç§°</label>
                        <input type="text" class="field-name-input" value="${field.name}" placeholder="ä¾‹å¦‚ï¼šFront">
                    </div>
                    <div class="form-group">
                        <label>æ­£åˆ™æ ‡å¿—</label>
                        <input type="text" class="field-flags-input" value="${field.flags}" placeholder="ä¾‹å¦‚ï¼šms">
                    </div>
                </div>
                <div class="form-group">
                    <label>æ­£åˆ™è¡¨è¾¾å¼</label>
                    <input type="text" class="regex-input field-regex-input" value="${field.regex}"
                           placeholder="ä¾‹å¦‚ï¼š^(.+?)(?=---div---|$)">
                </div>
            `;
            return div;
        }

        // å…¨å±€å‡½æ•°
        window.editTemplate = function(templateId) {
            openTemplateModal(templateId);
        };

        window.duplicateTemplate = function(templateId) {
            const template = templates.find(t => t.id === templateId);
            const newTemplate = {
                ...template,
                id: 'template_' + Date.now(),
                name: template.name + ' (å‰¯æœ¬)',
                isDefault: false
            };
            templates.push(newTemplate);
            renderTemplateList();
        };

        window.deleteTemplate = function(templateId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ')) {
                templates = templates.filter(t => t.id !== templateId);
                renderTemplateList();
            }
        };

        window.removeField = function(button) {
            button.closest('.field-editor').remove();
        };

        document.getElementById('addFieldBtn').addEventListener('click', () => {
            const fieldsList = document.getElementById('fieldsList');
            const fieldCount = fieldsList.children.length;
            const newField = createFieldEditor({ name: '', regex: '', flags: 'ms' }, fieldCount);
            fieldsList.appendChild(newField);
        });

        // ç¤ºä¾‹é€‰æ‹©
        exampleSelector.addEventListener('change', (e) => {
            const example = examples[e.target.value];
            if (example) {
                testInput.value = example;
                parseAndPreview();
            }
        });

        // è§£æå’Œé¢„è§ˆ
        function parseAndPreview() {
            const content = testInput.value;
            const cards = parseContent(content);
            renderPreview(cards);
            updateStats(cards);
        }

        // ç®€åŒ–çš„è§£æé€»è¾‘ï¼ˆæ¼”ç¤ºç”¨ï¼‰
        function parseContent(content) {
            const cards = [];
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ ‡ç­¾è§¦å‘
            if (!content.includes('#tuanki')) {
                return cards;
            }

            // ç®€å•çš„å¡ç‰‡è§£æ
            if (content.includes('---start---') && content.includes('---end---')) {
                // æ‰¹é‡è§£æ
                const batchContent = content.match(/---start---([\s\S]*?)---end---/);
                if (batchContent) {
                    const cardContents = batchContent[1].split('---å¡ç‰‡---');
                    cardContents.forEach((cardContent, index) => {
                        const card = parseSingleCard(cardContent.trim(), index + 1);
                        if (card) cards.push(card);
                    });
                }
            } else {
                // å•å¡è§£æ
                const card = parseSingleCard(content, 1);
                if (card) cards.push(card);
            }

            return cards;
        }

        function parseSingleCard(content, index) {
            if (!content.trim()) return null;

            const card = {
                id: index,
                type: 'qa',
                front: '',
                back: '',
                tags: []
            };

            // æå–æ ‡ç­¾
            const tagMatches = content.match(/#[\w\u4e00-\u9fa5]+/g);
            if (tagMatches) {
                card.tags = tagMatches;
            }

            // æ£€æŸ¥æŒ–ç©ºé¢˜
            if (content.includes('==') && content.match(/==[^=]+?==/g)) {
                card.type = 'cloze';
                card.front = content.replace(/#[\w\u4e00-\u9fa5]+/g, '').trim();
                return card;
            }

            // æ£€æŸ¥é€‰æ‹©é¢˜
            if (content.match(/^- \[[ x]\]/m)) {
                card.type = 'mcq';
            }

            // åˆ†å‰²æ­£åé¢
            if (content.includes('---div---')) {
                const parts = content.split('---div---');
                card.front = parts[0].replace(/#[\w\u4e00-\u9fa5]+/g, '').trim();
                card.back = parts[1].replace(/#[\w\u4e00-\u9fa5]+/g, '').trim();
            } else {
                card.front = content.replace(/#[\w\u4e00-\u9fa5]+/g, '').trim();
                card.back = '';
            }

            return card;
        }

        // æ¸²æŸ“é¢„è§ˆ
        function renderPreview(cards) {
            previewCards.innerHTML = '';
            
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card-preview';
                
                let typeLabel = 'é—®ç­”é¢˜';
                if (card.type === 'mcq') typeLabel = 'é€‰æ‹©é¢˜';
                if (card.type === 'cloze') typeLabel = 'æŒ–ç©ºé¢˜';
                
                let frontContent = card.front;
                let backContent = card.back;
                
                // å¤„ç†æŒ–ç©ºæ˜¾ç¤º
                if (card.type === 'cloze') {
                    frontContent = card.front.replace(/==(.*?)==/g, '<span class="cloze-highlight">$1</span>');
                }
                
                // å¤„ç†é€‰æ‹©é¢˜æ˜¾ç¤º
                if (card.type === 'mcq') {
                    frontContent = frontContent.replace(/^- \[([ x])\] (.+)$/gm, (match, checked, text) => {
                        const isCorrect = checked === 'x';
                        return `<div class="mcq-option ${isCorrect ? 'correct' : ''}">${isCorrect ? 'âœ“' : 'â—‹'} ${text}</div>`;
                    });
                }
                
                cardElement.innerHTML = `
                    <div class="card-header">å¡ç‰‡ ${card.id} - ${typeLabel}</div>
                    <div class="card-content">
                        <div class="card-side">
                            <div class="card-side-label">æ­£é¢</div>
                            <div class="card-side-content">${frontContent || '(ç©º)'}</div>
                        </div>
                        ${backContent ? `
                        <div class="card-side">
                            <div class="card-side-label">èƒŒé¢</div>
                            <div class="card-side-content">${backContent}</div>
                        </div>
                        ` : ''}
                        <div class="card-tags">
                            ${card.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                previewCards.appendChild(cardElement);
            });
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats(cards) {
            document.getElementById('cardCount').textContent = cards.length;

            let clozeCount = 0;
            let tagCount = 0;
            let templateCount = new Set();

            cards.forEach(card => {
                if (card.type === 'cloze') {
                    const matches = card.front.match(/==[^=]+?==/g);
                    if (matches) clozeCount += matches.length;
                }
                tagCount += card.tags.length;
                if (card.template) {
                    templateCount.add(card.template);
                }
            });

            document.getElementById('clozeCount').textContent = clozeCount;
            document.getElementById('tagCount').textContent = tagCount;
            document.getElementById('templateCount').textContent = templateCount.size;
        }

        // ä¿å­˜æ¨¡æ¿
        document.getElementById('saveTemplate').addEventListener('click', () => {
            const name = document.getElementById('templateName').value.trim();
            const description = document.getElementById('templateDescription').value.trim();

            if (!name) {
                alert('è¯·è¾“å…¥æ¨¡æ¿åç§°');
                return;
            }

            const activeMode = document.querySelector('.template-mode-selector .mode-button.active').dataset.mode;

            let templateData = {
                name,
                description,
                type: activeMode,
                scenarios: [],
                isDefault: false
            };

            if (activeMode === 'single-field') {
                const fieldEditors = document.querySelectorAll('.field-editor');
                templateData.fields = Array.from(fieldEditors).map(editor => ({
                    name: editor.querySelector('.field-name-input').value,
                    regex: editor.querySelector('.field-regex-input').value,
                    flags: editor.querySelector('.field-flags-input').value
                }));
            } else {
                templateData.regex = document.getElementById('completeRegex').value;
                templateData.flags = document.getElementById('regexFlags').value;
            }

            if (currentEditingTemplate) {
                // ç¼–è¾‘ç°æœ‰æ¨¡æ¿
                const index = templates.findIndex(t => t.id === currentEditingTemplate);
                templates[index] = { ...templates[index], ...templateData };
            } else {
                // æ–°å»ºæ¨¡æ¿
                templateData.id = 'template_' + Date.now();
                templates.push(templateData);
            }

            closeTemplateModal();
            renderTemplateList();
        });

        // ç›‘å¬è¾“å…¥å˜åŒ–
        testInput.addEventListener('input', parseAndPreview);

        // åˆå§‹åŒ–
        switchTab('symbols');
        parseAndPreview();
    </script>
</body>
</html>
