# ⚡ Tuanki 快速开发指南

## 🚀 启动开发环境

### 1. 启动热重载服务器
```bash
cd "10-Project-Tuanki/anki-obsidian-plugin"
npm run dev
```

### 2. 验证启动成功
看到以下输出表示启动成功：
```
✅ 构建完成 - 输出到: D:\桌面\obsidian luman\.obsidian/plugins/tuanki
✓ 289 modules transformed.
built in 14117ms.
```

## 🔥 热重载开发流程

### 📝 代码修改 → 自动构建 → 即时生效

1. **修改代码文件**
   - 编辑 `.ts`、`.svelte`、`.css` 文件
   - 保存文件 (Ctrl+S)

2. **自动触发构建**
   ```
   build started...
   transforming (1) src\components\AnkiApp.svelte
   ✅ 构建完成
   ✓ 1 modules transformed.
   built in 6444ms.
   ```

3. **Obsidian 自动重载**
   - 插件自动更新
   - 无需手动重启

## 🎯 拖拽功能开发重点

### 🆕 新建卡片拖拽测试
```typescript
// 测试文件：src/components/TuankiApp.svelte
// 关键函数：handleDragDropEvent()

// 测试步骤：
// 1. 在 Obsidian 中选中文本
// 2. Ctrl+拖拽到插件主界面
// 3. 验证新建卡片模态窗打开
```

### ✏️ 卡片编辑拖拽测试
```typescript
// 测试文件：src/components/modals/CardEditModal.svelte
// 关键函数：handleEditCardDragDrop()

// 测试步骤：
// 1. 打开卡片编辑模态窗
// 2. 拖拽文本到模态窗
// 3. 验证内容直接追加到编辑器
```

## 🛠️ 开发工具和技巧

### 📊 实时监控
- **Vite 输出**：监控构建状态和时间
- **浏览器控制台**：查看 JavaScript 错误
- **Obsidian 控制台**：查看插件日志

### 🔍 调试技巧
```typescript
// 添加调试日志
console.log('🎯 拖拽事件:', event);
console.log('📝 解析结果:', parsedCard);

// 使用断点调试
debugger; // 在关键位置添加断点
```

### ⚡ 性能优化
- **增量构建**：只重新构建修改的文件
- **Source Map**：支持源码级调试
- **缓存机制**：利用 Vite 缓存加速构建

## 📋 常用开发命令

```bash
# 启动开发服务器（热重载）
npm run dev

# 生产构建
npm run build

# 运行测试
npm run test

# 代码检查
npm run check

# 代码格式化
npm run format

# 代码规范检查
npm run lint
```

## 🎨 UI 开发最佳实践

### 🎯 Svelte 5 Runes 模式
```svelte
<script lang="ts">
  // 使用新的 Runes 语法
  let count = $state(0);
  let doubled = $derived(count * 2);
  
  $effect(() => {
    console.log('Count changed:', count);
  });
</script>
```

### 🎨 主题适配
```css
/* 使用 CSS 变量确保主题兼容 */
.my-component {
  background: var(--background-primary);
  color: var(--text-normal);
  border: 1px solid var(--border-color);
}
```

## 🔧 故障排除

### ❌ 常见问题

1. **构建失败**
   ```bash
   # 清理缓存重新构建
   rm -rf node_modules/.vite
   npm run dev
   ```

2. **热重载不工作**
   ```bash
   # 重启开发服务器
   Ctrl+C  # 停止服务器
   npm run dev  # 重新启动
   ```

3. **TypeScript 错误**
   ```bash
   # 检查类型错误
   npm run check
   ```

### 🔍 调试步骤

1. **检查 Vite 输出**
   - 查看是否有构建错误
   - 确认文件变更被检测到

2. **检查浏览器控制台**
   - 查看 JavaScript 错误
   - 确认插件正确加载

3. **检查 Obsidian 控制台**
   - 查看插件特定错误
   - 确认拖拽事件触发

## 📈 开发进度跟踪

### ✅ 已完成功能
- [x] 热重载环境搭建
- [x] 拖拽管理器实现
- [x] 新建卡片拖拽场景
- [x] 卡片编辑拖拽场景
- [x] 类型安全保障

### 🔄 当前开发任务
- [ ] 拖拽功能完整测试
- [ ] 用户体验优化
- [ ] 错误处理完善
- [ ] 性能优化

### 🎯 下一步计划
- [ ] 三位一体模板集成测试
- [ ] 来源追踪功能验证
- [ ] 视觉反馈优化
- [ ] 文档完善

---

**开发状态**: 🟢 热重载正常运行  
**构建性能**: 增量构建 ~6-8秒  
**下次更新**: 功能测试完成后
