# 🔒 权重参数编辑开关功能

## 📋 功能概述

在FSRS6设置界面的权重参数部分新增了"允许编辑"开关功能，让用户可以控制是否允许修改21个权重参数，防止意外修改重要的算法参数。

## ✨ 功能特性

### 1. **安全保护机制**
- **默认锁定**: 权重参数默认处于锁定状态，防止意外修改
- **明确授权**: 用户需要主动启用编辑开关才能修改参数
- **视觉提示**: 清晰的UI状态显示当前是否可编辑

### 2. **用户友好界面**
- **现代开关**: 使用统一的现代开关组件
- **状态提示**: 根据开关状态显示不同的提示信息
- **禁用样式**: 禁用状态下输入框有明显的视觉区别

### 3. **智能提示系统**
- **锁定提示**: 参数锁定时显示解锁方法
- **警告提示**: 编辑模式下显示修改风险警告

## 🎨 界面设计

### 权重参数面板布局
```
┌─────────────────────────────────────────────────────────┐
│ 🔧 权重参数                           [允许编辑] ○      │
│ FSRS6算法的21个权重参数，影响记忆预测的准确性            │
├─────────────────────────────────────────────────────────┤
│ w0 [0.212] w1 [1.293] w2 [2.307] w3 [8.296]           │
│ w4 [6.413] w5 [0.833] w6 [3.019] w7 [0.001]           │
│ ... (21个参数网格，禁用状态显示为灰色)                   │
├─────────────────────────────────────────────────────────┤
│ ℹ️ 权重参数已锁定，启用"允许编辑"开关以修改参数          │
└─────────────────────────────────────────────────────────┘
```

### 编辑模式激活后
```
┌─────────────────────────────────────────────────────────┐
│ 🔧 权重参数                           [允许编辑] ●      │
│ FSRS6算法的21个权重参数，影响记忆预测的准确性            │
├─────────────────────────────────────────────────────────┤
│ w0 [0.212] w1 [1.293] w2 [2.307] w3 [8.296]           │
│ w4 [6.413] w5 [0.833] w6 [3.019] w7 [0.001]           │
│ ... (21个参数网格，可编辑状态)                          │
├─────────────────────────────────────────────────────────┤
│ ⚠️ 修改权重参数可能影响学习效果，请谨慎操作              │
└─────────────────────────────────────────────────────────┘
```

## 🔧 技术实现

### 1. **状态管理**
```typescript
let fsrs6State = $state({
  // ... 其他状态
  enableWeightEditing: false, // 权重参数编辑开关
  // ... 其他状态
});
```

### 2. **开关控制函数**
```typescript
function toggleWeightEditing() {
  fsrs6State.enableWeightEditing = !fsrs6State.enableWeightEditing;
}
```

### 3. **条件渲染和样式**
```svelte
<!-- 权重编辑开关 -->
<div class="modern-switch">
  <input
    type="checkbox"
    bind:checked={fsrs6State.enableWeightEditing}
    onchange={toggleWeightEditing}
  />
  <span class="switch-slider"></span>
</div>

<!-- 权重输入框 -->
<input
  type="number"
  disabled={!fsrs6State.enableWeightEditing}
  readonly={!fsrs6State.enableWeightEditing}
  class="weight-input"
  class:disabled={!fsrs6State.enableWeightEditing}
/>
```

### 4. **样式定义**
```css
.weight-input.disabled,
.weight-input:disabled {
  background: var(--background-modifier-border);
  color: var(--text-muted);
  cursor: not-allowed;
  opacity: 0.6;
}

.weight-edit-notice {
  background: var(--background-secondary);
  color: var(--text-muted);
  border: 1px solid var(--background-modifier-border);
}

.weight-edit-warning {
  background: rgba(255, 193, 7, 0.1);
  color: var(--text-normal);
  border: 1px solid rgba(255, 193, 7, 0.3);
}
```

## 🎯 用户体验流程

### 默认状态（锁定）
1. **进入设置**: 用户打开FSRS6设置界面
2. **查看参数**: 可以查看所有21个权重参数的当前值
3. **尝试编辑**: 输入框处于禁用状态，无法修改
4. **提示信息**: 显示"权重参数已锁定，启用'允许编辑'开关以修改参数"

### 启用编辑模式
1. **点击开关**: 用户点击"允许编辑"开关
2. **状态切换**: 开关变为启用状态（蓝色）
3. **输入框激活**: 所有权重参数输入框变为可编辑状态
4. **警告提示**: 显示"⚠️ 修改权重参数可能影响学习效果，请谨慎操作"

### 编辑参数
1. **修改数值**: 用户可以修改任意权重参数
2. **实时验证**: 输入值会进行范围验证
3. **自动保存**: 修改后自动保存到设置中
4. **即时生效**: 新参数立即应用到FSRS6算法

### 重新锁定
1. **关闭开关**: 用户可以随时关闭"允许编辑"开关
2. **参数锁定**: 输入框重新变为禁用状态
3. **保护模式**: 防止意外修改已设置的参数

## 🛡️ 安全特性

### 1. **防误操作**
- **默认锁定**: 避免用户无意中修改重要参数
- **明确授权**: 需要主动启用编辑模式
- **视觉区分**: 锁定和编辑状态有明显的视觉差异

### 2. **参数验证**
- **范围检查**: 确保输入值在有效范围内
- **类型验证**: 只允许输入数字类型
- **自动修复**: 无效参数会自动修复为默认值

### 3. **用户提醒**
- **风险警告**: 编辑模式下显示修改风险
- **操作指导**: 锁定状态下提供解锁指导
- **状态反馈**: 清晰的开关状态显示

## 📊 功能优势

### 1. **安全性提升**
- **防止误操作**: 避免用户意外修改算法参数
- **专业保护**: 保护FSRS6算法的核心参数不被随意更改
- **数据安全**: 确保学习数据和算法效果的稳定性

### 2. **用户体验优化**
- **直观控制**: 简单的开关操作，易于理解
- **状态清晰**: 明确的视觉反馈和提示信息
- **灵活使用**: 可以随时启用或禁用编辑功能

### 3. **专业性平衡**
- **新手友好**: 默认锁定保护新手用户
- **专家支持**: 高级用户可以启用编辑进行精细调优
- **风险控制**: 适当的警告和提示机制

## 🚀 使用建议

### 对于普通用户
1. **保持默认**: 建议保持权重参数锁定状态
2. **使用优化**: 通过智能优化功能自动调整参数
3. **谨慎修改**: 如需手动修改，请先了解参数含义

### 对于高级用户
1. **了解风险**: 修改前充分了解各参数的作用
2. **备份参数**: 修改前记录原始参数值
3. **逐步调整**: 建议小幅度调整并观察效果
4. **监控效果**: 修改后密切关注学习效果变化

---

**功能版本**: v1.0  
**实现时间**: 2025年1月  
**兼容性**: 支持所有FSRS6功能  
**状态**: ✅ 已实现并测试
