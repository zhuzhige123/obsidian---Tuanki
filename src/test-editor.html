<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMirror 编辑器测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .editor-wrapper {
            border: 1px solid #3c3c3c;
            border-radius: 8px;
            background: #252526;
            height: 400px;
            overflow: hidden;
        }
        
        .toolbar {
            display: flex;
            gap: 8px;
            padding: 8px 12px;
            background: #2d2d30;
            border-bottom: 1px solid #3c3c3c;
        }
        
        .toolbar button {
            background: #3c3c3c;
            border: none;
            color: #d4d4d4;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .toolbar button:hover {
            background: #464647;
        }
        
        .editor-content {
            height: calc(100% - 45px);
            padding: 12px;
            overflow: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .status {
            margin-top: 20px;
            padding: 12px;
            background: #2d2d30;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .test-content {
            margin-top: 20px;
        }
        
        .test-item {
            margin-bottom: 16px;
            padding: 12px;
            background: #2d2d30;
            border-radius: 4px;
        }
        
        .test-item h3 {
            margin: 0 0 8px 0;
            color: #569cd6;
        }
        
        .test-item p {
            margin: 0;
            font-size: 14px;
        }
        
        .success {
            color: #4ec9b0;
        }
        
        .error {
            color: #f44747;
        }
        
        .warning {
            color: #ffcc02;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 CodeMirror 编辑器测试页面</h1>
        
        <div class="editor-wrapper">
            <div class="toolbar">
                <button onclick="testBold()">粗体 (B)</button>
                <button onclick="testItalic()">斜体 (I)</button>
                <button onclick="testHeading()">标题 (H)</button>
                <button onclick="testList()">列表</button>
                <button onclick="testLink()">链接</button>
                <button onclick="testCode()">代码</button>
                <button onclick="clearEditor()">清空</button>
            </div>
            
            <div class="editor-content" id="editor" contenteditable="true">
# 测试内容

这是一个测试编辑器，用于验证：

1. **滚动条功能** - 当内容超出高度时应该显示滚动条
2. **工具栏功能** - 点击工具栏按钮应该能格式化文本
3. **快捷键支持** - Ctrl+B, Ctrl+I 等快捷键

## 长内容测试

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

### 更多内容

Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.

Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.

### 代码示例

```javascript
function testFunction() {
    console.log("这是一个测试函数");
    return true;
}
```

### 列表示例

- 项目 1
- 项目 2
  - 子项目 2.1
  - 子项目 2.2
- 项目 3

### 表格示例

| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据1 | 数据2 | 数据3 |
| 数据4 | 数据5 | 数据6 |

这里有足够的内容来测试滚动条是否正常工作。如果编辑器高度固定，应该能看到垂直滚动条。
            </div>
        </div>
        
        <div class="status" id="status">
            <strong>状态:</strong> 编辑器已加载，请测试滚动和工具栏功能
        </div>
        
        <div class="test-content">
            <div class="test-item">
                <h3>✅ 滚动条测试</h3>
                <p>编辑器内容超出高度时应该显示垂直滚动条。尝试滚动查看所有内容。</p>
            </div>
            
            <div class="test-item">
                <h3>🔧 工具栏测试</h3>
                <p>选择文本后点击工具栏按钮，应该能应用相应的Markdown格式。</p>
            </div>
            
            <div class="test-item">
                <h3>⌨️ 快捷键测试</h3>
                <p>尝试使用 Ctrl+B (粗体), Ctrl+I (斜体) 等快捷键。</p>
            </div>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const status = document.getElementById('status');
        
        function updateStatus(message, type = 'info') {
            const colors = {
                info: '#d4d4d4',
                success: '#4ec9b0',
                error: '#f44747',
                warning: '#ffcc02'
            };
            status.innerHTML = `<strong>状态:</strong> <span style="color: ${colors[type]}">${message}</span>`;
        }
        
        function getSelectedText() {
            const selection = window.getSelection();
            return selection.toString();
        }
        
        function replaceSelectedText(newText) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createTextNode(newText));
                selection.removeAllRanges();
            }
        }
        
        function testBold() {
            const selected = getSelectedText();
            if (selected) {
                replaceSelectedText(`**${selected}**`);
                updateStatus('应用粗体格式', 'success');
            } else {
                updateStatus('请先选择文本', 'warning');
            }
        }
        
        function testItalic() {
            const selected = getSelectedText();
            if (selected) {
                replaceSelectedText(`*${selected}*`);
                updateStatus('应用斜体格式', 'success');
            } else {
                updateStatus('请先选择文本', 'warning');
            }
        }
        
        function testHeading() {
            const selected = getSelectedText();
            if (selected) {
                replaceSelectedText(`## ${selected}`);
                updateStatus('应用标题格式', 'success');
            } else {
                updateStatus('请先选择文本', 'warning');
            }
        }
        
        function testList() {
            const selected = getSelectedText();
            if (selected) {
                replaceSelectedText(`- ${selected}`);
                updateStatus('应用列表格式', 'success');
            } else {
                updateStatus('请先选择文本', 'warning');
            }
        }
        
        function testLink() {
            const selected = getSelectedText();
            if (selected) {
                replaceSelectedText(`[${selected}](url)`);
                updateStatus('应用链接格式', 'success');
            } else {
                updateStatus('请先选择文本', 'warning');
            }
        }
        
        function testCode() {
            const selected = getSelectedText();
            if (selected) {
                replaceSelectedText(`\`${selected}\``);
                updateStatus('应用代码格式', 'success');
            } else {
                updateStatus('请先选择文本', 'warning');
            }
        }
        
        function clearEditor() {
            editor.textContent = '# 新文档\n\n开始编写内容...';
            updateStatus('编辑器已清空', 'info');
        }
        
        // 快捷键支持
        editor.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key.toLowerCase()) {
                    case 'b':
                        e.preventDefault();
                        testBold();
                        break;
                    case 'i':
                        e.preventDefault();
                        testItalic();
                        break;
                }
            }
        });
        
        // 初始化
        updateStatus('编辑器已加载，请测试功能', 'success');
    </script>
</body>
</html>
